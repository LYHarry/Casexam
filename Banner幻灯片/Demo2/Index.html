<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>每日分享</title>
    <link rel="stylesheet" href="css/idnex.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="js/banner3D.js"></script>
</head>

<body>

    <div class="content-warp">
        <p class="title">分享说明</p>
        <p>每分享一次，0.01元-1.00元人民币随机赚，分享越多赚得越多；</p>
        <p>每分享一次，1位-10位徒弟随便收；收徒还能赚5元；有效徒弟拿2级提成；</p>
        <p>每分享一次，轻松愉悦，让您的圈子有趣又有价值。</p>
    </div>

    <div class="main-warp">
        <!--<span class="prev"></span>
        <span class="next"></span>-->

        <div class="box-warp">
            <ul class="list-warp">
                <li>
                    <img class="sharecon" src="img/01.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>

                <li>
                    <img class="sharecon" src="img/02.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>

                <li>
                    <img class="sharecon" src="img/03.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>

                <li>
                    <img class="sharecon" src="img/04.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>

                <li>
                    <img class="sharecon" src="img/05.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>

                <li>
                    <img class="sharecon" src="img/06.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>

                <li>
                    <img class="sharecon" src="img/07.png" />
                    <div class="b_tit">
                        <p>一款1小时可以赚20元的APP</p>
                        <p>打开即可领取3元现金红包</p>
                        <img class="code" src="img/code.png" />
                        <p>邀请码：<span>1012356</span></p>
                    </div>
                </li>
            </ul>
        </div>

    </div>

    <div class="footer-warp">
        <img data-type="qq" src="img/img_fx_qq.png">
        <img data-type="pyq" src="img/img_fx_pyq.png">
        <img data-type="wx" src="img/img_fx_hy.png">
    </div>

    <script src="js/html2canvas.js"></script>
    <script type="text/javascript">
        //获取像素密度
        function getPixelRatio(context) {
            var backingStore = context.backingStorePixelRatio ||
                context.webkitBackingStorePixelRatio ||
                context.mozBackingStorePixelRatio ||
                context.msBackingStorePixelRatio ||
                context.oBackingStorePixelRatio ||
                context.backingStorePixelRatio || 1;
            return (window.devicePixelRatio || 1) / backingStore;
        };

        // Converts canvas to an image
        function convertCanvasToImage(canvas) {
            var image = new Image();
            image.src = canvas.toDataURL("image/png", 1.0);
            return image;
        };

        //绘制dom 元素，生成截图canvas
        function convertHtml2Canvas() {
            // 需要绘制的部分的 (原生）dom 对象 ，注意容器的宽度不要使用百分比，使用固定宽度，避免缩放问题
            if (typeof (nowLiIndex) == "undefined") {
                nowLiIndex = 1;
            }
            var node = $(".list-warp").find("li").eq(nowLiIndex);
            var userid = node.find("div.b_tit").find("span").html();

            var width = node.width(); // 获取(原生）dom 宽度
            var height = node.height(); // 获取(原生）dom 高
            //元素距离顶部的偏移量，放大倍数时，一定要注意元素离顶部的偏移量，否则会出现截取一半或没有
            var offsetTop = typeof (node.offsetTop) == "undefined" ? 200 : node.offsetTop;

            var canvas = document.createElement('canvas'); //创建canvas 对象
            var context = canvas.getContext('2d');
            var scaleBy = getPixelRatio(context); //获取像素密度的方法 (也可以采用自定义缩放比例)
            canvas.width = (width + offsetTop) * scaleBy; //这里 由于绘制的dom 为固定宽度，居中，所以没有偏移
            canvas.height = (height + offsetTop) * scaleBy; // 注意高度问题，由于顶部有个距离所以要加上顶部的距离，解决图像高度偏移问题
            context.scale(scaleBy, scaleBy);

            var opts = {
                allowTaint: true, //允许加载跨域的图片
                tainttest: true, //检测每张图片都已经加载完成
                scale: scaleBy, // 添加的scale 参数
                canvas: canvas, //自定义 canvas
                logging: true, //日志开关，发布的时候记得改成false
                width: width + 100, //dom 原始宽度
                height: height //dom 原始高度
            };
            html2canvas(node, opts).then(function (canvas) {

                var img = convertCanvasToImage(canvas);
                document.body.appendChild(img);
                //console.log(img.src);
                //var imgsrc = img.src.substr(22);
                //$.ajax({
                //    type: "post",
                //    url: "/DaysShare/SaveShareImg",
                //    data: { img: imgsrc, index: nowLiIndex, user: userid },
                //    dataType: "json",
                //    success: function (data) {
                //        var href = "";
                //        if (parseInt(data.state) == 1) {
                //            href = data.data;
                //        } else {
                //            href = "/Images/DaysShare/default.png";
                //        }

                //        href = "http://192.168.0.101:8094" + href;
                //        if (type == "qq") {
                //            zeare.appShareQQ({
                //                type: 2,
                //                imgUrl: href
                //            });

                //        } else if (type == "pyq") {
                //            zeare.appShareWeChatCircle({
                //                type: 2,
                //                imgUrl: href
                //            });
                //        } else {
                //            zeare.appShareWeChat({
                //                type: 2,
                //                imgUrl: href
                //            });
                //        }
                //    },
                //    error: function (e) {
                //        console.log(e);
                //    }
                //});
            }).catch(function (ex) {
                console.log(ex);
            });
        }

        $(".footer-warp").find("img").on("click", function () {
            console.log($(this).data("type"));
            convertHtml2Canvas($(this).data("type"));
        });
    </script>

</body>

</html>